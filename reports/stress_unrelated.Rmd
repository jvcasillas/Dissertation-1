---
author: 
  - name          : "Laura Fernandez Arroyo"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Postal address"
    email         : "my@email.com"
  - name          : "Nuria Sagarra"
    affiliation   : "1"
  - name          : "Cristina Lozano-Argüelles"
    affilitation  : "2"

affiliation:
  - id            : "1"
    institution   : "Rutgers University"
  - id            : "2"
    institution   : "John Jay College/CUNY"



keywords          : ""
wordcount         : ""

bibliography      : ["r-references.bib"]

floatsintext      : yes
figurelist        : yes
tablelist         : yes
footnotelist      : yes
linenumbers       : yes
mask              : yes
draft             : yes

documentclass     : "apa6"
classoption       : "man"
output            : papaja::apa6_word
---

```{r setup, include = FALSE}
library("papaja")
library("officer")
library("flextable")
```

```{r analysis-preferences}
# Seed for random number generation
set.seed(42)
knitr::opts_chunk$set(cache.extra = knitr::rand_seed)
```

```{r, 'source-scripts-models'}
source(here::here("scripts", "02_load_data.R"))
source(here::here("scripts", "01_helpers.R"))

# Get path to saved models
gca_mods_path  <- here("mods", "stress", "gca")

# Load models as list and store full mod to global env
load(paste0(gca_mods_path, "/full_mods_refactor.Rdata"))
load(paste0(gca_mods_path, "/model_preds.Rdata"))
load(paste0(gca_mods_path, "/full_mods_int.Rdata"))
load(paste0(gca_mods_path, "/nested_model_comparisons.Rdata"))

```






# BLC article (stress, natives, late advanced learners and interpreters)

## Overview

This document contains updates to the statistical analysis for stress_unrelated experiment 
(draft for ISB). 
Last updated on `r Sys.Date()`. 
The results section can be copied and pasted into the corresponding google doc. 
The tables can also be copy and pasted where appropriate. 

## Main changes

**Participants**  



**Analyses**  










# Plots

```{r, 'plot-ind-preds', echo=FALSE, fig.cap="Growth curve estimates of target fixations as a function of lexical stress and syllable structure for each group during the analysis window. Symbols and lines represent model estimates, and the transparent ribbons represents ±SE. Empirical logit values on y-axis correspond to proportions of 0.12, 0.50, 0.88, and 0.98. The horizontal dotted line represents the 50% probability of fixating on the target. The vertical dotted line indicates 200 ms after the offset of the target syllable."}
knitr::include_graphics(
  here("figs", "stress", "gca", "stress_p2.png")
)
```

```{r, 'plot-group-preds', echo=FALSE, fig.cap="Growth curve estimates of target fixations as a function of lexical stress and syllable structure for each group during the analysis window. Symbols and lines represent model estimates, and the transparent ribbons represents ±SE. Empirical logit values on y-axis correspond to proportions of 0.12, 0.50, 0.88, and 0.98. The horizontal dotted line represents the 50% probability of fixating on the target. The vertical dotted line indicates 200 ms after the offset of the target syllable."}
knitr::include_graphics(
  here("figs", "stress", "gca", "stress_p3.png")
)
```













# Tables 

## Model estimates at target syllable offset  


```{r, table-target-offset-props, eval=T, echo=F}

border_1 <- fp_border(width = 1.5)
border_2 <- fp_border(width = 0.75)

model_preds$target_offset_preds %>% 
  mutate(cond = if_else(cond == 1, "paroxytone", "oxytone")) %>% 
  arrange(group, desc(cond)) %>% 
  mutate(group = blank_same_as_last(as.character(group))) %>% 
  select(Group = group, `Lexical stress` = cond, Probability = prob, LB = prob_lb, 
         UB = prob_ub) %>% 
  flextable() %>% 
  width(., j = c(2, 3, 4), width = c(1.1, 1.3, 1.1)) %>% 
  font(., fontname = "Times", part = "all") %>%
  fontsize(., size = 11) %>% 
  border_remove(.) %>%  
  border(., part = "header", 
            border.top = border_1,
            border.bottom = border_2) %>% 
  hline_bottom(., part = "body", border = border_1)
```

*Table 1*: Model estimates for probability of target fixations ±SE at 200 ms 
after the target syllable offset.




## Fixed effects

```{r, warning=F}

# Get full mod and make it pretty for the table
pretty_fixed_effects <- full_mods_int$gca_full_mod_int_2 %>% 
  tidy_lme4() %>% 
  mutate(p = format_pval(p), 
         Parameter = fix_param_names(Parameter)) %>% 
  mutate_each(funs(format_fixef_num), Estimate:t) %>% 
  rename(`_t_` = t, `_p_` = p) 

# Include gammas (Gij) after each parameter name
subs <- c(paste0(0:3, 0), paste0(0:3, 1), 
          paste0(0:3, 2), paste0(0:3, 3), 
          paste0(0:3, 4), paste0(0:3, 5), 
          paste0(0:3, 6))
var_labels <- parenthesize(paste0(emphasize("&gamma;"), "~", subs, "~"))
pretty_fixed_effects$Parameter %<>% paste(., var_labels)

pretty_fixed_effects %>% 
  knitr::kable(format = "pandoc", align = str_tokenize("lrrrr")) 

```

Appendix 1: Growth curve model fixed effects






## Random effects

```{r, 'ranef-table', results = "asis"}
ranef_table <- full_mods_int$gca_full_mod_int_2 %>% 
  tidy_ranef_summary %>% 
  # Format the numbers
  mutate_each(funs(format_fixef_num), vcov, sdcor) %>%
  mutate_each(funs(format_cor), -var1, -grp, -vcov, -sdcor) %>%
  sort_ranef_grps %>%
  # Format variable names and group names
  mutate(var1 = fix_param_names(var1) %>% blank_nas,
         grp =  blank_same_as_last(grp) %>% fix_param_names) %>% 
  rename(Group = grp, Parameter = var1, Variance = vcov, SD = sdcor)

# Correlation columns need names with characters so that pandoc can align them
names(ranef_table)[5:9] <- 
  c("Correlations", "&nbsp;", " &nbsp;", "  &nbsp;", "  &nbsp;")

ranef_table %>% 
  knitr::kable(format = "pandoc", align = str_tokenize("llrrrrrr"))
```

Appendix 2: Growth curve model random effects




## Pairwise comparisons

```{r, 'learner-comparison'}
# make table for printing
pairwise_comp <- full_mods_refactor$gca_full_mod_int_2_ams %>% 
  tidy_lme4 %>% 
  rename(B = Estimate) %>% 
  filter(str_detect(Parameter, "mon") == TRUE) 

# Add subscript column, convert to rownames, and then add it again
pairwise_comp$subscript <- c(paste0(0:3, 8), paste0(0:1, 9))
pairwise_comp <- tibble::column_to_rownames(pairwise_comp, 'subscript')
pairwise_comp$subscript <- c(paste0(0:3, 8), paste0(0:1, 9))


# Shortcut for inline reporting from the above table
report_pairwise <- function(row_name) report_fixef_row(pairwise_comp, row_name)

```


```{r, pairwise-comp-table, results='asis', eval=T}

# Make table for appendix
pretty_pairwise_table <- full_mods$gca_full_mod_int_relevel %>% 
  tidy_lme4 %>% 
  mutate(p = format_pval(p), 
         Parameter = fix_param_names(Parameter)) %>% 
  mutate_each(funs(format_fixef_num), Estimate:t) %>% 
  rename(`_t_` = t, `_p_` = p) %>% 
  filter(str_detect(Parameter, "NIN") == TRUE) 

pretty_pairwise_table$Parameter %<>% str_replace("Group NIN", "IN - NIN")

# Include gammas after each parameter name
pw_subs <- c(paste0(0:3, 8), paste0(0:1, 9))
pw_var_labels <- parenthesize(paste0(emphasize("&gamma;"), "~", pw_subs, "~"))
pretty_pairwise_table$Parameter %<>% paste(., pw_var_labels)

pretty_pairwise_table %>% 
  knitr::kable(format = "pandoc", align = str_tokenize("lrrrr")) 

```

Appendix 3: Pairwise comparisons between learner groups. 




# Results

```{r, 'write-up-prep', warning=F, eval=T}
# Prepare table to support easy in-line printing of equations
# params <- pretty_fixed_effects %>% 
#  rename(B = Estimate)

params <- full_mods$gca_full_mod_int_2 %>% 
  tidy_lme4() %>% 
  rename(B = Estimate)

params$subscript <- 
  c(paste0(0:3, 0), paste0(0:3, 1), 
    paste0(0:3, 2), paste0(0:3, 3), 
    paste0(0:3, 4), paste0(0:3, 5), 
    paste0(0:3, 6))

params <- tibble::column_to_rownames(params, 'subscript')

params$subscript <- 
  c(paste0(0:3, 0), paste0(0:3, 1), 
    paste0(0:3, 2), paste0(0:3, 3), 
    paste0(0:3, 4), paste0(0:3, 5), 
    paste0(0:3, 6))

# Shortcut for inline reporting from the above table
report_row <- function(row_name) report_fixef_row(params, row_name)

# Pre-calculate intercept as proportion
b0 <- params$B[params$subscript == "00"] %>% as.numeric
b0_prop <- b0 %>% inv_logit %>% round(2) %>% remove_leading_zero

```



Figure 1 plots the model estimates from the GCA and the full model summary is 
available in Appendices 1 and 2. 
We report the results for the M group and then provide comparisons with and 
between the learner groups. 
The model intercept estimates the log odds of M fixating on the target, 
averaging over the time course, lexical stress and syllable structure. 
The log odds were _&gamma;_~00~&nbsp;=&nbsp;`r fixed_digits(b0, 2)` 
(proportion:&nbsp;`r b0_prop`). 
The linear, quadratic, and cubic polynomial time terms captured the sigmoid 
shape of the time course and were retained in the model 
(`r report_row("10")`; `r report_row("20")`; `r report_row("30")`). 

